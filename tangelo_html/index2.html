<html lang="en">

<head>
	<title>XDATA: Track Communities</title>
	<meta charset="utf-8">
	
	<!-- Stylesheets -->
        <link rel="stylesheet" href="css/jquery-ui-1.9.1.css">
	<link rel="stylesheet" href="lib/tangelo/css/tangelo.css" type="text/css">
	<link rel="stylesheet" href="lib/select2/select2.css" type="text/css">
	<link rel="stylesheet" href="lib/select2/select2-bootstrap.css" type="text/css">
	<link rel="stylesheet" href="lib/d3/css/d3.slider.css" type="text/css">
	<link rel="stylesheet" href="lib/d3/css/d3.tip.css" type="text/css">
	<link rel="stylesheet" href="lib/jQRangeSlider/css/classic-min.css" type="text/css">
	<link rel="stylesheet" href="lib/clearable_text_field/jquery.clearableTextField.css" type="text/css">
	<style type="text/css">
		#map-canvas {
			width:100%;
			height:100%;
		}
                #slidertext {
                   font-size: 14px;
                }
		svg {
			display:block; /* required for firefox to give valid
			height and width used values for getComputedStyle()
			see https://bugzilla.mozilla.org/show_bug.cgi?id=874919 
			*/
			//border: solid 1px gray;
			//margin:1em;
			height:calc(100% - 2em);
			width: calc(100% - 2em);
		}
		circle.node {
			stroke: #555;
			stroke-width: .5px;
		}
		div#tangelo-control-panel.control-panel {
		}
		div#tangelo-drawer-handle.centered.pointer.drawer {
		}
		.graticule {
		  fill: none;
		  stroke: #fff;
		  stroke-width: .5px;
		  stroke-opacity: .5;
		}
		.land {
		  fill: #d7c7ad;
		  stroke: #766951;
		  stroke-width: 1;
		}
		.boundary {
			fill: none;
			stroke: #a5967e;
		}
		.background {
			fill: #a4bac7;
		}
		.geojson {
			fill: none;
			stroke: red;
			stroke-width: 2;
			opacity: .5;
		}
		.SvgOverlay svg {
			position: absolute;
			top: -4000px;
			left: -4000px;
			width: 8000px;
			height: 8000px;
		}	
	</style>
	
	<!-- Scripts/Libraries -->
	<script type="text/javascript" src="lib/jquery/jquery-2.1.0.min.js"></script>
	<script type="text/javascript" src="lib/jquery-ui/js/jquery-ui-1.10.4.min.js"></script>
	<script type="text/javascript" src="lib/jquery/jquery.mousewheel.min.js"></script>
	<script type="text/javascript" src="lib/jQRangeSlider/jQDateRangeSlider-withRuler-min.js"></script>
	<script type="text/javascript" src="lib/momentjs/moment.min.js"></script>
	<script type="text/javascript" src="lib/clearable_text_field/jquery.clearableTextField.min.js"></script>
	<script type="text/javascript" src="lib/tangelo/js/tangelo.js"></script>
	<script type="text/javascript" src="lib/d3/js/d3.v3.min.js"></script>
	<script type="text/javascript" src="lib/d3/js/d3.slider.js"></script>
	<script type="text/javascript" src="lib/d3/js/d3.tip.js"></script>
	<script type="text/javascript" src="lib/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="lib/select2/select2.js"></script>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=visualization"></script>
	<script type="text/javascript" src="js/Number.js"></script>
	<script type="text/javascript" src="js/app/config.js"></script> 
	<script type="text/javascript" src="js/app/util.coordinates.js"></script> 
	<script type="text/javascript" src="js/app/util.graph.js"></script>
	<script type="text/javascript" src="js/app/util.map.js"></script>

</head>

<body style="height:85%;">
	
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12" style="">
				<!-- Utilize Tangelo utility to construct Bootstrap-based navigation bar -->
				<div data-tangelo-type="navbar" data-tangelo-brand="XDATA" data-tangelo-brand-href="#" data-tangelo-app="Track Communities" data-config-load="showConfig" data-config-save="updateConfig">
					<div data-tangelo-type="config">
					
						<h4> Load </h4>
						<p> Data Table: <input type="hidden" id="track-table" /> <br/> </p>
						<p>  </p>

						<!--
						table <input id="track-table" type=text><br/>
						<div id="graph_stat_string"></div>
						community id <input id="comm-id" type=text><br/>
						level <input id="level" type=text><br/>
						-->

					</div>
					
					<div data-tangelo-type="info">
						<p> TODO: Description or instructions on how to use the tool goes here. </p>
					</div>

				</div>
			</div>
		</div>
		<div class="row-fluid" style="margin-top:20px;">
			<div class="span4" style="margin-left:2px; margin-right:2px; ">
				<h4> Community Browser <small> (Enable Labels: <input type="checkbox" id="labelsEnabled" /><!-- | <a href="#" id="resetCommunityZoom">Reset Zoom</a> -->) </small> </h4>
				
				<div id="communityBrowserForm">				
					<div class="alert alert-error">
						<h5> Data Set Not Loaded! </h5>
						<p> Use the Configuration [Config] tab to select a data set to load into your Community Browser. </p>						
					</div>
				</div>
				
				<div id="communityGraph"></div>

			</div>
			<div class="span4" style="margin-left:2px; margin-right:2px;">
				<h4> Map <small>(Enable Heatmap: <input type="checkbox" id="heatMapEnabled" checked="checked" />)</small> </h4>
				<div id="map-canvas" class="gmap">***</div>
			</div>
			<div class="span4" style="margin-left:2px; margin-right:2px; ">
				<h4> Dynamic Graph </h4>
				
				<div id="dynamicGraph"></div>

			</div>
		</div>
	</div>

	<!-- Create a drawer panel with the controls in it -->
	<div data-tangelo-type="control-panel" class="control-panel">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span4">
                    <h5> Community Info </h5>
					<input id="graph_num_levels" type="hidden" />
					<p style="padding-top:0px;"> <small> <strong>INFO:</strong> <span id="graph_stat_string">Data table not loaded.</span> </small> </p>					
					<p style="padding-top:0px;"> <small> <strong>ID&nbsp;&nbsp;:</strong> </small> <input id="comm-id" type="text" disabled="true" style="padding: 6px; margin:0; height: 28px;" /> <small> <strong>LVL:</strong> </small> <input id="level" type="text" disabled="true" style="width: 75px;" />  <a id="applyCommunity" class="btn btn-mini" href="#"><i class="icon-search"></i> Go</a> </p>
				</div>
	
				<div class="span4">
					<h5> Find Communities (Time/Geo) </h5>
					<p style="padding-top:0px;"> <small>
				                <div style="margin-left: 30px; padding-top:0px; width: 75%;" id="range-slider"></div> 
                                                <div style="margin-left: 0px; padding-top:0px; width: 92%;"><span id="txt-low-val"></span> <div style="float:right;margin-right: 5px;"><span id="txt-high-val"><span></div></div>
						<div style="padding-top:0px; width: 75%;" id="dateRangeSliderMsg"><strong>SLIDER:</strong> Data table not loaded.</div> 
						<!-- <div style="margin-left: 30px; padding-top:0px; width: 75%;" id="dateRangeSlider"></div>  -->
					</small> </p>
					<p style="padding-top:0px;">
						<a id="capturePreviousCommunity" class="btn btn-mini" href="#"><i class="icon-backward"></i> Previous</a>
						<a id="captureCommunity" class="btn btn-mini" href="#"><i class="icon-search"></i> Find</a>						
					</p>
				</div>
			
				<div class="span4">
					<h5> Timeline (Map/Graph Playback) </h5>
					<div> <div id="time-slider" style="width: 75%;"></div> </div>
					<div id="slidertext">0</div>
					<a id="play" class="btn btn-mini">Play</a>
					<div id="speed-slider"></div>					
				</div>
				
				<div class="span4">
					&nbsp;
				</div>
				 
			</div>

		</div>
	</div>
	
    <!-- Scripts/Application -->
    <script type="text/javascript" src="js/app/main.js"></script> 
	<script type="text/javascript">
		$(document).ready( function() {
			$("#track-table").select2({
				width: '200',
				placeholder: "Select a data set...",
				minimumResultsForSearch: -1,
				ajax: {
					url: "community/tables",
					dataType: 'json',
					results: function (data, page) { 
						var results = [];
						for (var i=0, len=data.tables.length; i<len; i++) {
							var t = data.tables[i];
							results.push({
								id: t,
								text: t
							});
						}
						return {"results": results};
					}
				},
				initSelection : function (element, callback) {
					var data = {id: element.val(), text: element.val()};
					callback(data);
				}				
			});
			$("#level").select2({
				width: "resolve",
				placeholder: "...",
				minimumResultsForSearch: -1,
				allowClear: false,
				data: []
			});	
			$("#heatMapEnabled").on( "change", function() {
				var hm = $("#heatMapEnabled");
				if (hm.prop('checked') === true) {
					if ( $("#track-table").val() !== "") {
						renderHeatMap();
					}
				}
				else {
					heatmap.setMap(null);
				}
			});
			$("#labelsEnabled").on( "change", function() {
				var lab = communityVis.selectAll("text.label")
					.style("opacity", function(d, i) {
						var lab = $("#labelsEnabled");
						if (lab.prop('checked') === true) {
							return 1.0;
						}
						return 0;						
					});
					
				var map = g.selectAll("text.label")
					.style("opacity", function(d,i) {
						var lab = $("#labelsEnabled");
						if (lab.prop('checked') === true) {
							return 1.0;
						}
						return 0;						
					});				
				
				var dyn = dynamicVis.selectAll("text.label")
					.style("opacity", function(d,i) {
						var lab = $("#labelsEnabled");
						if (lab.prop('checked') === true) {
							return 1.0;
						}
						return 0;						
					});
			});			
			
			$('#comm-id').clearableTextField();
			
		});
	</script>
	
</body>

</html>
